Nginx в своем составе имеет модуль Geo, который без сторонних приложений и серверов может определять страну пользователя, из специально подготовленного списка адресов. 
Это позволит использовать официальный образ nginx, без его пересборки и не использовать сторонние платные сервисы с базами GeoIP.

Исходный файл для подготовки списка требуется взять свежий GeoIP-legacy.csv.gz на странице https://mailfud.org/geoip-legacy/

Распаковать GeoIP-legacy.csv, и запустить скрипт Python из данного репозитория.

Скрипт открывает файл GeoIP-legacy.csv и преобразует строки из данного формата **"1.2.9.0","1.2.9.255","16910592","16910847","RU","Russia"** в следующий формат **1.2.9.0-1.2.9.255 RU;** и сохраняет полученные строки в файл geo-country.conf, оставляя только IPv4.

Файл geo-country.conf положить на сервер рядом с nginx.conf.

В nginx.conf добавить в секцию http {} следующие строки:
```sh
geo $country {
        ranges; 
        default ETC; 
        include geo-country.conf;
    }
```

Теперь переменную $country можно использовать в конфиге и передовать в бекэнд. 

Вот пример конфига, разрешающий вход, только с российских ip адресов.
В файл сервера (default) в секцию server {} добавить следующие строки:
```sh
if ($country != RU) {   
            return 403;   
        }
```

Перезапустить контейнер с nginx.

Приложенный исходный файл и выходной список IP за 18 июля 2025 года.
